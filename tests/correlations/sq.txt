# Test Case 02 - Calculated structure factor for water vs. EPSR simulated data

# Define Water Molecule
Species 'Water'
  # Atoms
  Atom    1    O     0.015   -0.009   -0.373   'OW'
  Atom    2    H     0.757    0.013    0.217   'HW'
  Atom    3    H    -0.771   -0.003    0.157   'HW'

  # Intramolecular Terms
  Bond    1    2     Harmonic  3000.0   0.995
  Bond    1    3     Harmonic  3000.0   0.995
  Angle    2    1    3   Harmonic  400.0   109.5

  # Isotopologues
  Isotopologue  'Protiated'  OW=0  HW=0
  Isotopologue  'Deuteriated'  OW=0  HW=2
EndSpecies

# Define Configuration
Configuration  'Bulk'
  Density  9.99999642E-02 atoms/A3
  Multiplier  1000
  SpeciesInfo  'Water'  1.0
  InputCoordinates  epsr  'epsr/waterbox.ato'
EndConfiguration

Layer  'Processing'

  # Calculate and test RDFs
  Module  RDF
    Configuration  'Bulk'
    Frequency  1
    BinWidth 0.03
  EndModule

# -- Partial g(r) (unbound terms)
Module  DataTest  'Partial g(r) (unbound)'
  Threshold  0.31
  ErrorType  RMSE
  Data1D  'Bulk//OriginalGR//OW-OW//Unbound'  xy  'epsr/water.EPSR.g01'  y=2
  Data1D  'Bulk//OriginalGR//OW-HW//Unbound'  xy  'epsr/water.EPSR.g01'  y=4
  Data1D  'Bulk//OriginalGR//HW-HW//Unbound'  xy  'epsr/water.EPSR.g01'  y=6
EndModule

# -- Partial g(r) (intramolecular terms)
Module  DataTest  'Partial g(r) (bound)'
  ErrorType  RMSE
  Threshold  2.15
  Data1D  'Bulk//OriginalGR//OW-HW//Bound'  xy  'epsr/water.EPSR.y01'  y=4
  Data1D  'Bulk//OriginalGR//HW-HW//Bound'  xy  'epsr/water.EPSR.y01'  y=6
EndModule

# -- Partial g(r) (intramolecular terms)
Module  DataTest  'Partial g(r) (zeroed bound)'
  Threshold  0.001
  Data1D  'Bulk//OriginalGR//OW-OW//Bound'  xy  'epsr/water.EPSR.y01'  y=2
EndModule

Module  NeutronSQ  'D2O'
  QMin 0.05
  QBroadening  OmegaDependentGaussian  0.02    # For SLS
  WindowFunction  None
  Configuration  'Bulk'
  Isotopologue  'Bulk'  'Water'  'Deuteriated'  1.0
  SaveUnweighted  On
  Frequency  1
EndModule

# -- Partial S(Q) (unbound terms)
Module  DataTest  'Partial S(Q) (unbound)'
  ErrorType  RMSE
  Threshold  0.25
  Data1D  'D2O//UnweightedSQ//OW-OW//Unbound'  xy  'epsr/water.EPSR.f01'  y=2
  Data1D  'D2O//UnweightedSQ//OW-HW//Unbound'  xy  'epsr/water.EPSR.f01'  y=4
  Data1D  'D2O//UnweightedSQ//HW-HW//Unbound'  xy  'epsr/water.EPSR.f01'  y=6
EndModule

# -- Partial S(Q) (bound terms)
Module  DataTest  'Partial S(Q) (bound)'
  ErrorType  RMSE
  Threshold  0.7
  Data1D  'D2O//UnweightedSQ//OW-HW//Bound'  xy  'epsr/water.EPSR.s01'  y=4
  Data1D  'D2O//UnweightedSQ//HW-HW//Bound'  xy  'epsr/water.EPSR.s01'  y=6
EndModule

# -- Partial S(Q) (bound terms)
Module  DataTest  'Partial S(Q) (zeroed bound)'
  ErrorType  RMSE
  Threshold  0.001
  Data1D  'D2O//UnweightedSQ//OW-OW//Bound'  xy  'epsr/water.EPSR.s01'  y=2
EndModule

# -- Total neutron-weighted F(Q)
Module  DataTest  'F(Q) D2O'
  ErrorType  RMSE
  Threshold  2.0e-3
  Data1D  'D2O//WeightedSQ//Total'  xy  'epsr/water.EPSR.u01'  y=2
EndModule

Module  NeutronSQ  'H2O'
  QMin 0.05
  QBroadening  OmegaDependentGaussian  0.02    # For SLS
  WindowFunction  None
  Configuration  'Bulk'
  Isotopologue  'Bulk'  'Water'  'Protiated'  1.0
  # Save  On
  Frequency  1
EndModule

# -- Total neutron-weighted F(Q)
Module  DataTest  'F(Q) H2O'
  ErrorType  RMSE
  Threshold  0.09
  Data1D  'H2O//WeightedSQ//Total'  xy  'epsr/water.EPSR.u01'  y=4
EndModule

Module  NeutronSQ  'HDO'
  QMin 0.05
  QBroadening  OmegaDependentGaussian  0.02    # For SLS
  WindowFunction  None
  Configuration  'Bulk'
  Isotopologue  'Bulk'  'Water'  'Protiated'  0.5
  Isotopologue  'Bulk'  'Water'  'Deuteriated'  0.5
  Exchangeable  HW
  # Save  On
  Frequency  1
EndModule

# -- Total neutron-weighted F(Q)
Module  DataTest  'F(Q) HDO'
  ErrorType  RMSE
  Threshold  0.06
  Data1D  'HDO//WeightedSQ//Total'  xy  'epsr/water.EPSR.u01'  y=6
EndModule

Module SanityCheck
EndModule

EndLayer

# Pair Potentials
PairPotentials
  Range  15.000000
  Delta  0.050000
  Parameters  'OW'  -0.82      0.6503    3.165492
  Parameters  'HW'  0.41       0.0       0.0
  GenerateAll  LJ
EndPairPotentials

Simulation
   RestartFileFrequency  -1
EndSimulation

