# Test Case 02 - Calculated structure factor for water vs. EPSR simulated data

# Define Water Molecule
Species 'Water'
  # Atoms
  Atom    1    O     0.015   -0.009   -0.373   'OW'
  Atom    2    H     0.757    0.013    0.217   'HW'
  Atom    3    H    -0.771   -0.003    0.157   'HW'

  # Intramolecular Terms
  Bond   Harmonic   1    2     3000.0  0.995
  Bond   Harmonic   1    3     3000.0  0.995
  Angle  Harmonic   2    1    3   400.0  109.500

  # Isotopologues
  Isotopologue  'Protiated'  OW=0  HW=0
  Isotopologue  'Deuteriated'  OW=0  HW=2
EndSpecies

# Define Configuration
Configuration  'Bulk'
  Density  9.99999642E-02 atoms/A3
  Multiplier  1000
  SpeciesInfo  'Water'  1.0
  InputCoordinates  epsr  'epsr/waterbox.ato'
  RDFBinWidth 0.03
  RDFRange 15.5
EndConfiguration

# Samples
Module Partials 'RDFs'
  StructureFactor  Off
  Configuration  'Bulk'
  Weights  neutron
  Isotopologue  'Bulk'  'Water'  'Deuteriated'  1.0
  # Save  On
  TestThreshold  0.57
  Frequency  1

  Test  on
  # -- Partial g(r) (unbound terms), unweighted
  TestReference  'epsr/water.EPSR.g01'  GR-unweighted-OW-OW-unbound  1  2
  TestReference  'epsr/water.EPSR.g01'  GR-unweighted-OW-HW-unbound  1  4
  TestReference  'epsr/water.EPSR.g01'  GR-unweighted-HW-HW-unbound  1  6
  # -- Partial g(r) (intramolecular terms), unweighted
  TestReference  'epsr/water.EPSR.y01'  GR-unweighted-OW-OW-bound  1  2
  TestReference  'epsr/water.EPSR.y01'  GR-unweighted-OW-HW-bound  1  4
  TestReference  'epsr/water.EPSR.y01'  GR-unweighted-HW-HW-bound  1  6
EndModule

Module Partials 'D2O'
  StructureFactor  on
  QMin 0.05
  QDependentBroadening  DependentGaussian  0.02    # For SLS
  Configuration  'Bulk'
  Weights  neutron
  Isotopologue  'Bulk'  'Water'  'Deuteriated'  1.0
  # Save  On
  TestThreshold  0.1
  Frequency  1
  # -- Partial S(Q) (unbound terms), unweighted
  TestReference  'epsr/water.EPSR.f01'  SQ-unweighted-OW-OW-unbound  1  2
  TestReference  'epsr/water.EPSR.f01'  SQ-unweighted-OW-HW-unbound  1  4
  TestReference  'epsr/water.EPSR.f01'  SQ-unweighted-HW-HW-unbound  1  6
  # -- Partial S(Q) (bound terms), unweighted
  TestReference  'epsr/water.EPSR.s01'  SQ-unweighted-OW-OW-bound  1  2
  TestReference  'epsr/water.EPSR.s01'  SQ-unweighted-OW-HW-bound  1  4
  TestReference  'epsr/water.EPSR.s01'  SQ-unweighted-HW-HW-bound  1  6
  # -- Total neutron-weighted S(Q)
  TestReference  'epsr/water.EPSR.u01'  SQ-weighted-total  1  2
EndModule

Module Partials 'H2O'
  StructureFactor  on
  QMin 0.05
  QDependentBroadening  DependentGaussian  0.02    # For SLS
  Configuration  'Bulk'
  Weights  neutron
  Isotopologue  'Bulk'  'Water'  'Protiated'  1.0
  # Save  On
  TestThreshold  0.26
  Frequency  1
  Test  on
  # -- Total neutron-weighted S(Q)
  TestReference  'epsr/water.EPSR.u01'  SQ-weighted-total  1  4
EndModule

Module Partials 'HDO'
  StructureFactor  on
  QMin 0.05
  QDependentBroadening  DependentGaussian  0.02    # For SLS
  Configuration  'Bulk'
  Weights  neutron
  Isotopologue  'Bulk'  'Water'  'Protiated'  0.5
  Isotopologue  'Bulk'  'Water'  'Deuteriated'  0.5
  # Save  On
  TestThreshold  0.11
  Frequency  1

  Test  on
  # -- Total neutron-weighted S(Q)
  TestReference  'epsr/water.EPSR.u01'  SQ-weighted-total  1  6
EndModule

# Pair Potentials
PairPotentials
  Range  15.000000
  Delta  0.050000
  TruncationWidth  2.000000
  Generate  'LJ'  'OW'  'OW'
  Generate  'LJ'  'OW'  'HW'
  Generate  'LJ'  'HW'  'HW'
EndPairPotentials

Simulation
   MaxIterations  1
   WriteIterationData  false
EndSimulation

